/*!  30-09-2020 */

define(["underscore","backbone","mousetrap","cello","gviz","materials","moment","numeric","pdgconst"],function(h,g,i,c,e,t,s,n,a){c.DEBUG=!0;var p={};p.User=g.Model.extend({defaults:{username:"",logged:!1,login_url:"../account/login",logout_url:"../account/logout"},login:function(e){var t=this;$.ajax({url:this.get("login_url"),type:"POST",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){console.log("success",e),t.set(e),e.logged&&""!=e.username&&(g.trigger("user:logged_in",t.attributes),console.log("triggered",t.attributes))},error:function(){t.trigger("user:loginError")}})},logout:function(){var t=this;$.ajax({url:this.get("logout_url"),type:"POST",data:JSON.stringify({}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){t.set(e),g.trigger("user:logged_out",t.attributes),console.log("triggered","user:logged_out",t.attributes)},error:function(){t.trigger("user:logoutError")}})}}),p.Cluster=c.Cluster.extend({initialize:function(e,t){var s=this;p.Cluster.__super__.initialize.apply(this,arguments),this.on("change:color",function(){s.members.vs.each(function(e){e.set("cl_color",s.color)})})},_unselect:function(){this.members.vs.each(function(e){e.remove_flag("cluster")});var e=this.collection.without(this);h(e).each(function(e){e.members.vs.each(function(e){e.remove_flag("cluster-faded"),h.each(e.incident(),function(e){e.remove_flag("es-cluster-faded")})})})}}),p.Vertex=c.Vertex.extend({classname:"Models.Vertex",defaults:{uuid:null,nodetype:null,properties:new g.Model,cl_color:[0,0,0],color:[0,0,0]},url:function(){return this.graph.url()+"/node"+(this.id?"/"+this.id:"")},star:function(){this.set_starred(!0)},unstar:function(){this.set_starred(!1)},set_starred:function(e){var t=this.url()+(e?"/star":"/unstar");$.ajax({url:t,type:"POST",data:JSON.stringify({start:0}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){},error:function(){}})},format_label:function(e){var t=this.label;return e&&(t=t.substring(0,e)),[{form:t,css:".form"}]},to_str:function(){return this.label},validate:function(e,t){var s=[];if(e.nodetype||s.push({field:"nodetype",header:"Nodetype",message:"a nodetype is required"}),Object.keys(e.properties.attributes).length||s.push({field:"properties",header:"Properties",message:"a node should have a property"}),s.length)return s},parse:function(e,t){return e.properties&&(e.properties=new g.Model(e.properties,{parse:!0})),e},get_properties:function(){var s=this,n={};return this.nodetype.get("properties").each(function(e){var t=e.get("name");"uuid"!=t&&(n[t]=s.properties.get(t))}),n},fetch_neighbors:function(e,o){var a=this,t=this.url();this._neighbors?o(this._neighbors):$.ajax({url:t+"/neighbors",type:"POST",data:JSON.stringify({start:0,mode:this.mode}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){var t={};if(e.neighbors){for(var s in e.neighbors){var n=e.neighbors[s];t[n[0].uuid]=n}var i=[];for(var r in t)i.push(t[r]);a._neighbors=i}o(a._neighbors)}})},toCard:function(){return{uuid:this.id,label:this.label,nodetype:this.nodetype.get("name")}},toJSON:function(e){return{uuid:this.get("uuid"),nodetype:this.get("nodetype"),properties:this.get_properties()}}},{active_flags:["intersected","faded","selected"]}),p.EdgeType=c.EdgeType.extend({parse_label:function(){var e=this.label,t={};return t.label=e,t.family=0<=e.indexOf("/")?e.substring(0,e.indexOf("/")):"",t.name=0<e.indexOf("/")?e.substring(e.indexOf("/")+1):e,t}}),p.Edge=c.Edge.extend({url:function(){return this.graph.url()+"/edge"+(this.id?"/"+this.id:"")},get_properties:function(){var s=this,n={};return this.edgetype.get("properties").each(function(e){var t=e.get("name");"uuid"!=t&&(n[t]=s.properties.get(t))}),n},validate:function(e,t){var s=[];if(e.source||s.push({field:"source",header:"Source",message:"a source is required"}),e.target||s.push({field:"target",header:"Target",message:"a target is required"}),e.edgetype||s.push({field:"edgetype",header:"Edgetype",message:"a edgetype is required"}),s.length)return s},parse:function(e,t){return e.properties&&(e.properties=new g.Model(e.properties,{parse:!0})),e},toJSON:function(e){return{uuid:this.id,edgetype:this.edgetype.id,source:this.get("source"),target:this.get("target"),properties:this.get_properties()}}},{active_flags:["intersected","faded","selected"]}),p.UuidEdgeListQuery=g.Model.extend({defaults:{graph:null},export_for_engine:function(){var e=h.map(this.get("graph").es.models,function(e){return e.get("uuid")});return{format:"uuid_edgelist",graph:this.get("graph").get("gid"),edgelist:e}}}),p.IndexEdgeListQuery=g.Model.extend({defaults:{graph:null},export_for_engine:function(){var e=this.get("graph"),t=h.chain(e.vs.models).filter(function(e){return 0==e.has_flag("disabled")}).map(function(e){return e.get("uuid")}).value(),s=h.chain(t).map(function(e,t){return[e,t]}).object().value(),n=h.chain(e.es.models).filter(function(e){return 0==e.has_flag("disabled")}).map(function(e,t){return[s[e.source.id],s[e.target.id]]}).value(),i=h.chain(e.es.models).filter(function(e){return 0==e.has_flag("disabled")}).map(function(e,t){var s=e.properties.get("weight",1);return s?parseFloat(s):1}).value();return{format:"index_edgelist",graph:this.get("graph").get("gid"),nodelist:t,edgelist:n,weights:i,directed:!0}}}),p.ExpandNodesQuery=g.Model.extend({defaults:{graph:null,nodes:[],expand:[],weights:[]},export_for_engine:function(){var e=h.map(this.get("graph").vs.models,function(e){return e.get("uuid")});return{graph:this.get("graph").get("gid"),nodes:e,expand:this.get("expand"),weights:this.get("weights")}}}),p.ClustersLabelsQuery=g.Model.extend({defaults:{graph:null,clustering:[]},export_for_engine:function(){var e=this.get("clustering").clusters.models.map(function(e){return e.members.vs.models.map(function(e){return e.id})});return{graph:this.get("graph").get("gid"),clusters:e}}}),p.AdditiveNodesQuery=g.Model.extend({defaults:{graph:null,uuids:[]},export_for_engine:function(){var e=h.map(this.get("graph").vs.models,function(e){return e.get("uuid")});return{graph:this.get("graph").get("gid"),nodes:e,add:this.get("uuids")}}}),p.QueryUnit=g.Model.extend({defaults:{query:"",valid:!1},initialize:function(e,t){this.on("change",this.validate)},set_from_str:function(e){this.set("query",e)},to_string:function(){return this.get("query")},toJSON:function(){return{query:this.get("query")}},validate:function(){}}),QueryUnits=g.Collection.extend({model:p.QueryUnit,graph:"",reset_from_models:function(e){!1===h.isArray(e)&&(e=[e]);var s=[],n=this.model;h.each(e,function(e){attrs=h.pick(e,"query");var t=new n(attrs);s.push(t)}),this.reset(s)},reset_from_str:function(e){console.log("query : "+e);var s=this.model,n=[],t=e.split(",");h.each(t,function(e){var t=new s;t.set_from_str(e),n.push(t)}),this.reset(n)},reset_random:function(){var s=this,n=this.model;$.ajax({url:this.random_url,dataType:"json",success:function(e){var t=new n(e);s.reset_from_models([t])}})},to_string:function(){return this.models.map(function(e){return e.to_string()}).join("; ")},validate:function(){return 0<this.length},export_for_engine:function(){return{graph:this.graph,units:this.toJSON()}}});var u=[];function _(t,e,s){s&&s.length?s+=" ":s="",h.each(e,function(e){h.isString(e)?u.push("\n"+e):l(s+e[0],e[1],e[2],t)})}function l(e,t,s,n){n=void 0===n?document:n,i().bind(e,s),u.push("'"+e+"' : "+t)}function d(e,t){var s;_(e.$el,(s=e,["* Labels ",["l","toggles node/edge label display",function(){s.show_text=!s.show_text,s.renderer.DISPLAY_EDGE_LABEL=!s.renderer.DISPLAY_EDGE_LABEL,s.request_animation()}],["+","increase vertex size",function(){s.increase_vertex_size()}],["-","decrease vertex size",function(){s.decrease_vertex_size()}],[",","increase font label size",function(){s.user_font_size=Math.min(25,s.user_font_size+1),s.request_animation()}],[";","decrease font label size",function(){s.user_font_size=Math.max(-5,s.user_font_size-1),s.request_animation()}],"* Nodes/edges ",["n","toggle node display",function(){s.show_nodes=!s.show_nodes,s.request_animation()}],["e","toggle edge display",function(){s.show_edges=!s.show_edges,s.request_animation()}],["i","toggle node image display",function(){s.show_images=!s.show_images,s.request_animation(),console.log("toggle image display",s.show_images)}],"* Rendering ",["r","toggles autorotate",function(){s.controls.AUTO_ROTATE=!s.controls.AUTO_ROTATE,s.request_animation()}],["d","increases autorotate speed",function(){s.controls.autoRotateSpeed=1.5*s.controls.autoRotateSpeed}],["s","decreases autorotate speed",function(){s.controls.autoRotateSpeed=s.controls.autoRotateSpeed/1.5}],["e","toggle end arrow display",function(){s.renderer.DISPLAY_EDGE=!s.renderer.DISPLAY_EDGE,s.request_animation()}],["a","toggle init arrows display",function(){s.DISPLAY_ARROW_END=!s.DISPLAY_ARROW_END,s.DISPLAY_ARROW_INIT=!s.DISPLAY_ARROW_INIT,s.request_animation()}],["f","toggle fog display",function(){s.ENABLE_FOG=!s.ENABLE_FOG,s.request_animation()}],["w","toggle coords transition",function(){s.changeCoordSpeed=10<s.changeCoordSpeed?10:500}]]),t)}var f=function(e,t){try{var s=numeric.dot(numeric.transpose(e),t),n=numeric.svd(s),i=numeric.transpose(n.U),r=n.V,o=(numeric.det(numeric.dot(r,i)),[[1,0,0],[0,1,0],[0,0,1]]),a=numeric.dot(numeric.dot(r,o),i),u=numeric.dot(t,a);numeric.norm2(numeric.sub(e,t)),numeric.norm2(numeric.sub(e,u));return u}catch(e){return console.log("rotate_graph",e),t}};function r(e){e.id&&$("#img"+e.id).remove()}function o(s){if(s.id&&s.properties.get("image")){var n=s.properties.get("image");"svg"==n.substring(n.length-3)?$.ajax({url:n,dataType:"text",success:function(e){var t=new Image;t.onload=function(){var e=document.getElementById("gviz_imgs_cache_canvas");e.width=400,e.height=400,e.getContext("2d").drawImage(t,0,0,400,400),n=e.toDataURL("image/png"),$("#gviz_model_imgs").append("<img id='img"+s.id+"' src='"+n+"'/>")},t.src="data:image/svg+xml;charset=utf-8,"+e}}):$("#gviz_model_imgs").append("<img id='img"+s.id+"' src='"+n+"'/>")}}function m(e){e.id&&e.properties&&e.properties.changed&&e.properties.changed.image&&(r(e),o(e))}function v(e,t){var s=e.vs;if(s.length&&!(!t|!("results"in t)|!("layout"in t.results))){var n=t.results.layout.coords,i=[],r=[],o={},a=0;for(var u in n){var l=n[u];l.push(0),r.push(l.slice(0,3)),s.get(u).get("coords")?i.push(s.get(u).get("coords").slice(0,3)):i.push(l.slice(0,3)),o[u]=a,a++}for(var u in Q_new=f(i,r),n){s.get(u).set("coords",Q_new[o[u]])}var d=s.map(function(e){return e.degree()}),g=d.reduce(function(e,t){return t<e?e:t}),c=d.reduce(function(e,t){return e<t?e:t});s.each(function(e){var t=e.degree();e.set("_size",c<g?(t-c)/(g-c):1)})}}var y={};return y.Models=p,y.Base=g.View.extend({DEBUG:!1,initialize:function(e){this.DEBUG=e.debug||this.DEBUG,this.root_url=e.root_url||"/";var t;for(k in this.routes={},e.routes)this.routes[k]=(t=e.routes[k])&&h.isString(t)?{url:t}:"url"in t?t:null;this.complete_url=this.routes.complete_url,this.login_url=e.login_url,this.logout_url=e.logout_url,this.random_url=e.random_url,this.fullscreen=!1,this.$el=void 0===e.$el?document:e.$el,this.ALLOW_AUTO_COMPUTE=!0,this._auto_compute_delay=!1,this.Models=p,this.models=h.clone({}),this.engines=h.clone({})},create_user_model:function(){var e=new p.User;e.listenTo(g,"user:logout",e.logout),e.listenTo(g,"user:login",e.login),this.models.user=e},create_query_model:function(){this.models.query=new QueryUnits([],{})},create_graph_model:function(e){var t=this;e=h.extend({vertex_model:p.Vertex,edge_model:p.Edge,edgetype_model:p.EdgeType},e||{});var s=new c.Graph(e);t.models.graph=s,t.listenTo(s.es,"remove",h.bind(t.auto_compute,t)),t.listenTo(s.vs,"add",t.auto_compute,t),t.listenTo(s.vs,"add",o),t.listenTo(s.vs,"change",m),t.listenTo(s.vs,"remove",function(e){r(e),s.vs.set_selected([])}),t.listenTo(g,a.unselect_nodes,function(){s.vs.set_selected([])}),t.listenTo(g,a.unselect_edges,function(){s.es.set_selected([])}),t.listenTo(g,a.select_node,function(e){e.id&&s.vs.get(e.id)&&(g.trigger(a.unselect_nodes),g.trigger(a.unselect_edges),s.vs.set_selected(e))}),t.listenTo(g,a.select_edge,function(e,t){g.trigger(a.unselect_nodes),g.trigger(a.unselect_edges)}),t.listenTo(g,a.remove_all,function(){t.set_auto_compute(!1),s.vs.set([]),s.es.set([]),t.set_auto_compute(!0)}),t.listenTo(g,a.remove_node,function(e){t.set_auto_compute(!1),e&&(s.vs.set_selected([]),s.vs.remove(e)),t.set_auto_compute(!0),t.trigger("engine:auto_compute",t.models.graph)}),t.listenTo(g,a.remove_edge,function(e){t.set_auto_compute(!1),e&&(s.es.set_selected([]),s.es.remove(e)),t.set_auto_compute(!0),t.trigger("engine:auto_compute",t.models.graph)}),this.listenTo(g,"request-graph-clear",function(e){g.trigger(a.unselect_nodes),g.trigger(a.unselect_edges),t.set_auto_compute(!1),s.vs.set([]),t.set_auto_compute(!0)})},create_clustering_model:function(){this.models.clustering=new c.Clustering({ClusterModel:p.Cluster,color_saturation:71,color_value:80})},create_engines:function(){function e(e){var t=new c.Engine(e);return i.listenTo(t,"play:loading",function(){g.trigger("play:loading",t)}),i.listenTo(t,"play:error",function(){g.trigger("play:complete",t)}),i.listenTo(t,"play:success",function(){g.trigger("play:complete",t)}),t}var i=this,t=i.routes;if(t.explore){var r=e({url:t.explore.url});r.register_input("request",i.models.query),i.listenTo(g,"engine:explore",function(e,t){if(r.blocks.length){console.log("engine:layout",e);var s=r.blocks.at(0).components;s.each(function(e){e.set("selected",!1)});var n=s.get(e);(n=n||s.at(0)).set("selected",!0),t&&i.models.query.reset_from_models(t),r.play()}}),i.listenTo(r,"play:success",i.explore_reset),i.engines.explore=r}if(t.starred){var s=e({url:t.starred.url});s.register_input("request",i.models.query),i.listenTo(g,"engine:starred",function(e){i.models.query.reset_from_models(e),s.play()}),i.listenTo(s,"play:success",i.explore_reset),i.engines.starred=s}if(t.additive_nodes){var n=new p.AdditiveNodesQuery({graph:i.models.graph});i.engines.additive_nodes=e({url:t.additive_nodes.url}),i.engines.additive_nodes.register_input("request",n),i.listenTo(g,"engine:additive_nodes",i.additive_nodes),i.listenTo(i.engines.additive_nodes,"play:success",i.merge_graph)}if(t.expand_px){var o=new p.ExpandNodesQuery({graph:i.models.graph});i.engines.expand_prox=e({url:t.expand_px.url}),i.engines.expand_prox.register_input("request",o),i.listenTo(g,"engine:expand_prox",function(e){console.log("engine:expand_prox",e),o.set("expand",e.expand),o.set("weights",e.weights),i.engines.expand_prox.play()}),i.listenTo(i.engines.expand_prox,"play:success",i.expand_graph)}if(t.layout){var a=e({url:t.layout.url});a.register_input("request",new p.IndexEdgeListQuery({graph:i.models.graph})),i.on("engine:layout",function(e){if(a.blocks.length){console.log("engine:layout",e);var t=a.blocks.at(0).components;t.each(function(e){e.set("selected",!1)});var s=t.get(e);(s=s||t.at(0)).set("selected",!0),a.play()}});i.models.graph;i.listenTo(a,"play:success",h.partial(function(e,t,s){v(t,s),e._additive_nodes_delayed=!1,g.trigger("engine:request_animation")},i,i.models.graph)),i.engines.layout=a}if(t.clustering){var u=e({url:t.clustering.url});u.register_input("request",new p.IndexEdgeListQuery({graph:i.models.graph})),i.on("engine:clustering",function(e){console.log("engine:clustering",e);var t=u.blocks;if(t.length){var s=t.at(0).components;s.each(function(e){e.set("selected",!1)});var n=s.get(e);(n=n||s.at(0)).set("selected",!0),u.play()}}),i.listenTo(u,"play:success",i.apply_clustering),i.engines.clustering=u}for(var l in t)if(!i.engines[l]){var d=e({url:t[l].url});i.engines[l]=d}i.listenTo(g,"play:error",i.engine_play_error),i.on("engine:auto_compute",i.auto_compute)},fetch_engines:function(e){function c(e){if(--s.count,console.log(" engine_fetched ",s.count),0==s.count)if(s.complete)s.complete(p);else{var t=new Event("app_engines_fetched",{bubbles:!0,cancelable:!1});document.dispatchEvent(t)}}var p=this,s={complete:e,count:h.size(p.engines)};for(var t in p.engines.layout&&p.engines.layout.fetch({success:function(e,t,s,n){if(h.size(t.blocks)){var i=t.blocks.at(0).components.models,r=[],o=["# Layouts"],a=0;for(var u in i){var l=""+ ++a,d=i[u].id+"|";d=d.substring(0,d.indexOf("|"));var g=""+i[u].id;o.push([l,d,function(e){return function(){p.trigger("engine:layout",e)}}(g)]),r.push({name:d,value:g,model:i[u]})}_(this.$el,o,"!"),p.setLayouts(r),c()}}}),p.engines.clustering&&p.engines.clustering.fetch({success:function(e,t,s,n){if(h.size(t.blocks)){var i=t.blocks.at(0).components.models,r=[],o=["# Community detection"],a=0;for(var u in i){var l=""+ ++a,d=i[u].id+"|";d=d.substring(0,d.indexOf("|"));var g=i[u].id;o.push([l,d,function(e){return function(){p.trigger("engine:clustering",e)}}(g)]),r.push({name:d,value:g,model:i[u]})}_(this.$el,o,":"),p.setClusterings(r),c()}}}),p.engines)console.log(" FETCH ENGINES "+t),"clustering"!=t&&"layout"!=t&&p.engines[t].fetch({success:c})},auto_compute:function(){if(this.ALLOW_AUTO_COMPUTE&&!this._auto_compute_delay){var e=this.models.graph;e&&e.vs&&e.vs.length&&(this.engines.clustering&&this.engines.clustering.play(),this.engines.layout&&this.engines.layout.play())}},noop:function(){},additive_nodes:function(e,t){if(this._additive_nodes_uuids=h.union(this._additive_nodes_uuids,e),!this._additive_nodes_delay){this._additive_nodes_delayed=!0;var s=this.engines.additive_nodes;console.log("engine:additive_nodes",this._additive_nodes_uuids,t),s.input_models.request.set("uuids",this._additive_nodes_uuids),s.play(t),this._additive_nodes_uuids=[]}},explore_reset:function(e){g.trigger(a.unselect_nodes),g.trigger(a.unselect_edges);var t=this;t.response=e,console.log("explore_reset",e.results),t.set_auto_compute(!1),e.results.graph&&(t.models.graph.reset(e.results.graph),t.models.graph.set("gid",e.results.graph.properties.name),t.models.graph.vs.each(function(e){e.add_flag("form")})),t.set_auto_compute(!0),t.auto_compute()},expand_graph:function(e){if(console.log("expand_graph",e.results),!(!e|!("results"in e))){var t=this.models.graph,s=[],n=h.pairs(e.results.scores);for(var i in n.sort(function(e,t){return e[1]<t[1]?1:-1}),n){var r=n[i][0],o=n[i][1];if(null==t.vs.get(r)){if(10<=s.length&&o<1)break;console.log("expand_graph adding vertex : "+r,o),s.push(r)}}s.length&&g.trigger("engine:additive_nodes",s)}},clusters_labels:function(e,t){this.models.clustering.set_labels(e.results,t)},merge_graph:function(e,t){!e|!("results"in e)|!("graph"in e.results)||(this.set_auto_compute(!1),(t=t||{})&&t.reset?this.models.graph.reset(e.results.graph):this.models.graph.merge(e.results.graph),this.models.graph.vs.each(function(e){e.add_flag("form")}),t.callback&&t.callback(),this.set_auto_compute(!0),this.auto_compute())},apply_clustering:function(e){if(!e|!("results"in e)|!("clusters"in e.results))g.trigger("engine:error",{message:"No response or no results in response",response:e});else{for(var t in this.models.clustering.reset(e.results.clusters,{members:{vs:{source:this.models.graph.vs,id_field:"vids"}}}),this.models.clustering.clusters.each(function(e){e.listenTo(g,"unselect_clusters",function(){e.remove_flag("selected")})}),this.models.clustering.clusters.models){var s=this.models.clustering.clusters.at(t),n=s.members.vs.models,i="000"+t,r=i.substring(i.length-3)+"/"+(s.misc?"0":"1");h.each(n,function(e){e.set("_sort_by_cluster",r+"/"+e.label)})}g.trigger("engine:request_animation")}},set_auto_compute:function(e){this.ALLOW_AUTO_COMPUTE=e},search_loading:function(e,t){},engine_play_error:function(e,t){var s;console.log("play:error","response",e),$("#loading-indicator").hide(0),this.DEBUG&&(this.response=e,this.xhr=t,h.isEmpty(e)?(s=$(t.responseText),$("body").css("margin","0")):s=e.meta.errors.join("<br />"),$("body").after(s))},set_viz:function(s){var e,n,t,i,r=this,o=r.models.graph;this.listenTo(g,a.select_node,function(e){if(r.AUTO_FOCUS){var t=h.pick(s.wnidx[e.id].position,"x","y","z");s.setFocus(t)}s.request_animation()}),this.listenTo(g,a.select_edge,function(e,t){e&&o.es.set_selected(e),s.setFocus()}),this.listenTo(o,"change:gid",function(){s.collapse()}),l("h","Displays help",function(){var e=u.join("\n");console.log(e)}),d(s,""),e=this.$el,n=this.models.graph,_(e,[["enter","Expands node relations",function(){var e=n.vs.by_flag("selected");if(1==e.length){var t={graph:n.id,expand:[e[0].id],weights:[]};g.trigger("engine:expand_prox",t)}}],["shift+enter","Explore",function(){var e=n.vs.by_flag("selected");if(1==e.length){var t={graph:n.id,query:e[0].id};g.trigger("engine:explore",t)}}],["backspace","Removes node from view",function(){var e=n.vs.by_flag("selected");1==e.length&&g.trigger(a.remove_node,e[0])}]],""),t=this.$el,i=this.models.graph,_(t,["# Graph edition",["e","edits selected node",function(){var e=i.vs.by_flag("selected");1==e.length&&g.trigger("edit:node",e[0])}]],""),s.animate()},install_listeners:function(){}}),y.Iframe=y.Base.extend({initialize:function(e,t){y.Iframe.__super__.initialize.apply(this,arguments)},setClusterings:function(e){this.clusterings=e},setLayouts:function(e){this.layouts=e}}),y.Simple=y.Base.extend({initialize:function(e,t){y.Simple.__super__.initialize.apply(this,arguments)},setClusterings:function(e){var t=$("padagraph-app-menu")[0],s=$("padagraph-controls")[0];t.clusterings=e,s.clusterings=e,this.clusterings=e},setLayouts:function(e){var t=$("padagraph-app-menu")[0],s=$("padagraph-controls")[0];t.layouts=e,s.layouts=e,this.layouts=e},create_models:function(){this.create_graph_model(),this.create_clustering_model(),this.create_query_model(),this.create_user_model()},start:function(){var e=this,t=e.models.graph;e.listenTo(t,"change:gid",function(){$("padagraph-graph-button")[0].graphname=t.id});var s=$("padagraph-app-menu")[0];s.themes=Object.keys(THEMES),s.graph=t,s.app=e;var n=$("padagraph-controls")[0];n.themes=Object.keys(THEMES),n.app=e,n.gviz=o,n.graph=t,n.setupUI();var i=$("padagraph-create")[0];i.graph=t,i.nodetype_model=t.nodetype_model,i.edgetype_model=t.edgetype_model,i.vertex_model=t.vertex_model,i.edge_model=t.edge_model,$("padagraph-edits")[0].graph=t,$("padagraph-messages")[0].graph=t,$("padagraph-node-search")[0].graph=t,$("padagraph-notifications")[0].setGraphModel(t),$("#newNodeType").click(function(){g.trigger("edit:nodetype",!1)}),initUI(),this.setFullscreen=function(e){this.fullscreen=e,setFullscreen(e)},this.setTheme=setTheme;var r=$("padagraph-gviz")[0],o=r.gviz;e.set_viz(o),this.gviz=r,window._app=this,window.Cello=c,window.Models=p,console.warn=function(){}}}),y});