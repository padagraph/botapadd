/*!  20-03-2018 */
define(["underscore","backbone","mousetrap","cello","gviz","materials","moment","numeric","pdgconst"],function(a,b,c,d,e,f,g,h,i){function j(b,c,d){d&&d.length?d+=" ":d="",a.each(c,function(c){if(a.isString(c))y.push("\n"+c);else{var e=d+c[0];l(e,c[1],c[2],b)}})}function l(a,b,d,e){e=void 0===e?document:e,c().bind(a,d),y.push("'"+a+"' : "+b)}function m(a,c,d){var e=["# Graph edition",["e","edits selected node",function(){var a=c.vs.by_flag("selected");1==a.length&&b.trigger("edit:node",a[0])}]];j(a,e,d)}function n(a,c,d){var e=[["enter","Expands node relations",function(){var a=c.vs.by_flag("selected");if(1==a.length){var d={graph:c.id,nodes:[a[0].id],weights:[]};b.trigger("engine:expand_prox",d)}}],["shift+enter","Explore",function(){var a=c.vs.by_flag("selected");if(1==a.length){var d={graph:c.id,query:a[0].id};b.trigger("engine:explore",d)}}],["backspace","Removes node from view",function(){var a=c.vs.by_flag("selected");1==a.length&&b.trigger(i.remove_node,a[0])}]];j(a,e,d)}function o(a,b){j(a.$el,z(a),b)}function p(){l("h","Displays help",function(){var a=y.join("\n");console.log(a)})}function q(a){return a.reduce(function(a,b){return a>b?a:b})}function r(a){return a.reduce(function(a,b){return a<b?a:b})}function s(a){a.id&&$("#img"+a.id).remove()}function t(a){if(a.id&&a.properties.get("image")){var b=a.properties.get("image");"svg"==b.substring(b.length-3)?$.ajax({url:b,dataType:"text",success:function(c){var d=new Image;d.onload=function(){var c=document.getElementById("gviz_imgs_cache_canvas");c.width=400,c.height=400,c.getContext("2d").drawImage(d,0,0,400,400),b=c.toDataURL("image/png"),$("#gviz_model_imgs").append("<img id='img"+a.id+"' src='"+b+"'/>")},d.src="data:image/svg+xml;charset=utf-8,"+c}}):$("#gviz_model_imgs").append("<img id='img"+a.id+"' src='"+b+"'/>")}}function u(a){a.id&&a.properties&&a.properties.changed&&a.properties.changed.image&&(s(a),t(a))}function v(a,b){var c=a.vs;if(c.length&&!(!b|!("results"in b)|!("layout"in b.results))){var d=b.results.layout.coords,e=[],f=[],g={},h=0;for(var i in d){var j=d[i];j.push(0),f.push(j.slice(0,3)),c.get(i).get("coords")?e.push(c.get(i).get("coords").slice(0,3)):e.push(j.slice(0,3)),g[i]=h,h++}Q_new=A.rotate_graph(e,f);for(var i in d){var k=c.get(i);k.set("coords",Q_new[g[i]])}var l=c.map(function(a){return a.degree()}),m=q(l),n=r(l);c.each(function(a){var b=a.degree();a.set("_size",m>n?(b-n)/(m-n):1)})}}var w=!0;d.DEBUG=w,w||(console.log=function(){});var x={};x.User=b.Model.extend({defaults:{username:"",logged:!1,login_url:"../account/login",logout_url:"../account/logout"},login:function(a){var c=this;$.ajax({url:this.get("login_url"),type:"POST",data:JSON.stringify(a),contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){console.log("success",a),c.set(a),a.logged&&""!=a.username&&(b.trigger("user:logged_in",c.attributes),console.log("triggered",c.attributes))},error:function(){c.trigger("user:loginError")}})},logout:function(){var a=this;$.ajax({url:this.get("logout_url"),type:"POST",data:JSON.stringify({}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(c){a.set(c),b.trigger("user:logged_out",a.attributes),console.log("triggered","user:logged_out",a.attributes)},error:function(){a.trigger("user:logoutError")}})}}),x.Cluster=d.Cluster.extend({initialize:function(a,b){var c=this;x.Cluster.__super__.initialize.apply(this,arguments),this.on("change:color",function(){c.members.vs.each(function(a){a.set("cl_color",c.color)})})},_unselect:function(){this.members.vs.each(function(a){a.remove_flag("cluster")});var b=this.collection.without(this);a(b).each(function(b){b.members.vs.each(function(b){b.remove_flag("cluster-faded"),a.each(b.incident(),function(a){a.remove_flag("es-cluster-faded")})})})}}),x.Vertex=d.Vertex.extend({classname:"Models.Vertex",constructor:function(){b.Model.apply(this,arguments),d.get(this,"type",function(){return this.nodetype}),d.get(this,"properties",function(){return this.get("properties")}),d.get(this,"label",function(){return this.properties.get("label")}),this.properties||this.set("properties",new b.Model),this.on("change:cl_color",function(a){a.set("color",a.get("cl_color"))}),this.on("change",function(a){a._neighbors=null})},defaults:{uuid:null,nodetype:null,properties:new b.Model,cl_color:[0,0,0],color:[0,0,0]},idAttribute:"uuid",url:function(){return this.graph.url()+"/node"+(this.id?"/"+this.id:"")},star:function(){this.set_starred(!0)},unstar:function(){this.set_starred(!1)},set_starred:function(a){var b=this.url()+(a?"/star":"/unstar");$.ajax({url:b,type:"POST",data:JSON.stringify({start:0}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){},error:function(){}})},format_label:function(a){var b=".form",c=this.label;return a&&(c=c.substring(0,a)),[{form:c,css:b}]},to_str:function(){return this.label},validate:function(a,b){var c=[];if(a.nodetype||c.push({field:"nodetype",header:"Nodetype",message:"a nodetype is required"}),Object.keys(a.properties.attributes).length||c.push({field:"properties",header:"Properties",message:"a node should have a property"}),c.length)return c},parse:function(a,c){return a.properties&&(a.properties=new b.Model(a.properties,{parse:!0})),a},get_properties:function(){var a=this,b={};return this.nodetype.get("properties").each(function(c){var d=c.get("name");"uuid"!=d&&(b[d]=a.properties.get(d))}),b},fetch_neighbors:function(a,b){var c=this,d=this.url();return this._neighbors?void b(this._neighbors):void $.ajax({url:d+"/neighbors",type:"POST",data:JSON.stringify({start:0,mode:this.mode}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){var d={};if(a.neighbors){for(var e in a.neighbors){var f=a.neighbors[e],g=f[0].uuid;d[g]=f}var h=[];for(var i in d)h.push(d[i]);c._neighbors=h}b(c._neighbors)}})},toCard:function(){return{uuid:this.id,label:this.label,nodetype:this.nodetype.get("name")}},toJSON:function(a){return{uuid:this.get("uuid"),nodetype:this.get("nodetype"),properties:this.get_properties()}}},{active_flags:["intersected","faded","selected"]}),x.EdgeType=d.EdgeType.extend({parse_label:function(){var a=this.label,b=(a.substring(a.indexOf("/")+1),{});return b.label=a,b.family=a.indexOf("/")>=0?a.substring(0,a.indexOf("/")):"",b.name=a.indexOf("/")>0?a.substring(a.indexOf("/")):a,b.subscript="",b}}),x.Edge=d.Edge.extend({constructor:function(){b.Model.apply(this,arguments),d.get(this,"type",function(){return this.edgetype}),d.get(this,"properties",function(){return this.get("properties")}),d.get(this,"label",function(){var a=this.properties.get("label");return null!=a&&0!=a.length||!this.edgetype?a:this.edgetype.name}),this.properties||this.set("properties",new b.Model)},url:function(){return this.graph.url()+"/edge"+(this.id?"/"+this.id:"")},get_properties:function(){var a=this,b={};return this.edgetype.get("properties").each(function(c){var d=c.get("name");"uuid"!=d&&(b[d]=a.properties.get(d))}),b},validate:function(a,b){var c=[];if(a.source||c.push({field:"source",header:"Source",message:"a source is required"}),a.target||c.push({field:"target",header:"Target",message:"a target is required"}),a.edgetype||c.push({field:"edgetype",header:"Edgetype",message:"a edgetype is required"}),c.length)return c},parse:function(a,c){return a.properties&&(a.properties=new b.Model(a.properties,{parse:!0})),a},toJSON:function(a){return{uuid:this.id,edgetype:this.edgetype.id,source:this.get("source"),target:this.get("target"),properties:this.get_properties()}}},{active_flags:["intersected","faded","selected"]}),x.UuidEdgeListQuery=b.Model.extend({defaults:{graph:null},export_for_engine:function(){var b=a.map(this.get("graph").es.models,function(a){return a.get("uuid")});return{format:"uuid_edgelist",graph:this.get("graph").get("gid"),edgelist:b}}}),x.IndexEdgeListQuery=b.Model.extend({defaults:{graph:null},export_for_engine:function(){var b=this.get("graph"),c=a.chain(b.vs.models).filter(function(a){return 0==a.has_flag("disabled")}).map(function(a){return a.get("uuid")}).value(),d=a.chain(c).map(function(a,b){return[a,b]}).object().value(),e=a.chain(b.es.models).filter(function(a){return 0==a.has_flag("disabled")}).map(function(a,b){return[d[a.source.id],d[a.target.id]]}).value(),f=a.chain(b.es.models).filter(function(a){return 0==a.has_flag("disabled")}).map(function(a,b){var c=a.properties.get("weight",1);return c?parseFloat(c):1}).value();return{format:"index_edgelist",graph:this.get("graph").get("gid"),nodelist:c,edgelist:e,weights:f,directed:!0}}}),x.ExpandNodesQuery=b.Model.extend({defaults:{graph:null,nodes:[],weights:[]},export_for_engine:function(){return{graph:this.get("graph").get("gid"),nodes:this.get("nodes"),weights:this.get("weights")}}}),x.ClustersLabelsQuery=b.Model.extend({defaults:{graph:null,clustering:[]},export_for_engine:function(){var a=this.get("clustering"),b=a.clusters.models,c=b.map(function(a){var b=a.members.vs.models.map(function(a){return a.id});return b});return{graph:this.get("graph").get("gid"),clusters:c}}}),x.AdditiveNodesQuery=b.Model.extend({defaults:{graph:null,uuids:[]},export_for_engine:function(){var b=a.map(this.get("graph").vs.models,function(a){return a.get("uuid")});return{graph:this.get("graph").get("gid"),nodes:b,add:this.get("uuids")}}}),x.QueryUnit=b.Model.extend({defaults:{query:"",valid:!1},initialize:function(a,b){this.on("change",this.validate)},set_from_str:function(a){this.set("query",a)},to_string:function(){return this.get("query")},toJSON:function(){return{query:this.get("query")}},validate:function(){}}),QueryUnits=b.Collection.extend({model:x.QueryUnit,graph:"",reset_from_models:function(b){a.isArray(b)===!1&&(b=[b]);var c=[],d=this.model;a.each(b,function(b){attrs=a.pick(b,"query");var e=new d(attrs);c.push(e)}),this.reset(c)},reset_from_str:function(b){console.log("query : "+b);var c=this.model,d=[],e=b.split(",");a.each(e,function(a){var b=new c;b.set_from_str(a),d.push(b)}),this.reset(d)},reset_random:function(){var a=this,b=this.model;$.ajax({url:this.random_url,dataType:"json",success:function(c){var d=new b(c);a.reset_from_models([d])}})},to_string:function(){return this.models.map(function(a){return a.to_string()}).join("; ")},validate:function(){return this.length>0},export_for_engine:function(){return{graph:this.graph,units:this.toJSON()}}});var y=[],z=function(a){return["* Labels ",["l","toggles node/edge label display",function(){a.show_text=!a.show_text,a.renderer.DISPLAY_EDGE_LABEL=!a.renderer.DISPLAY_EDGE_LABEL,a.request_animation()}],["+","increase vertex size",function(){a.increase_vertex_size()}],["-","decrease vertex size",function(){a.decrease_vertex_size()}],[",","increase font label size",function(){a.user_font_size=Math.min(25,a.user_font_size+1),a.request_animation()}],[";","decrease font label size",function(){a.user_font_size=Math.max(-5,a.user_font_size-1),a.request_animation()}],"* Nodes/edges ",["n","toggle node display",function(){a.show_nodes=!a.show_nodes,a.request_animation()}],["e","toggle edge display",function(){a.show_edges=!a.show_edges,a.request_animation()}],["i","toggle node image display",function(){a.show_images=!a.show_images,a.request_animation(),console.log("toggle image display",a.show_images)}],"* Rendering ",["r","toggles autorotate",function(){a.controls.AUTO_ROTATE=!a.controls.AUTO_ROTATE,a.request_animation()}],["d","increases autorotate speed",function(){a.controls.autoRotateSpeed=1.5*a.controls.autoRotateSpeed}],["s","decreases autorotate speed",function(){a.controls.autoRotateSpeed=a.controls.autoRotateSpeed/1.5}],["e","toggle end arrow display",function(){a.renderer.DISPLAY_EDGE=!a.renderer.DISPLAY_EDGE,a.request_animation()}],["a","toggle init arrows display",function(){a.DISPLAY_ARROW_END=!a.DISPLAY_ARROW_END,a.DISPLAY_ARROW_INIT=!a.DISPLAY_ARROW_INIT,a.request_animation()}],["f","toggle fog display",function(){a.ENABLE_FOG=!a.ENABLE_FOG,a.request_animation()}],["w","toggle coords transition",function(){a.changeCoordSpeed=a.changeCoordSpeed>10?10:500}]]},A={rotate_graph:function(a,b){try{var c=numeric.dot(numeric.transpose(a),b),d=numeric.svd(c),e=numeric.transpose(d.U),f=d.V,g=numeric.det(numeric.dot(f,e)),h=(0!=g)*(1-2*(g<0));h=1;var i=[[1,0,0],[0,1,0],[0,0,h]],j=numeric.dot(numeric.dot(f,i),e),k=numeric.dot(b,j);numeric.norm2(numeric.sub(a,b)),numeric.norm2(numeric.sub(a,k));return k}catch(a){return console.log("rotate_graph",a),b}}},B={};return B.Models=x,B.Base=b.View.extend({DEBUG:!1,initialize:function(b){this.DEBUG=b.debug||this.DEBUG,this.root_url=b.root_url||"/";var c=function(b){return b&&a.isString(b)?{url:b}:"url"in b?b:null};this.routes={};for(k in b.routes)this.routes[k]=c(b.routes[k]);this.complete_url=this.routes.complete_url,this.login_url=b.login_url,this.logout_url=b.logout_url,this.random_url=b.random_url,this.fullscreen=!1,this.$el=void 0===b.$el?document:b.$el,this.ALLOW_AUTO_COMPUTE=!0,this._auto_compute_delay=!1,this.Models=x,this.models=a.clone({}),this.engines=a.clone({})},create_user_model:function(){var a=this,c=new x.User;c.listenTo(b,"user:logout",c.logout),c.listenTo(b,"user:login",c.login),a.models.user=c},create_query_model:function(){var a=this;a.models.query=new QueryUnits([],{})},create_graph_model:function(c){var e=this;c=a.extend({vertex_model:x.Vertex,edge_model:x.Edge,edgetype_model:x.EdgeType},c?c:{});var f=new d.Graph(c);e.models.graph=f,e.listenTo(f.es,"remove",a.bind(e.auto_compute,e)),e.listenTo(f.vs,"add",e.auto_compute,e),e.listenTo(f.vs,"add",t),e.listenTo(f.vs,"change",u),e.listenTo(f.vs,"remove",function(a){s(a),f.vs.set_selected([])}),e.listenTo(b,i.unselect_nodes,function(){f.vs.set_selected([])}),e.listenTo(b,i.unselect_edges,function(){f.es.set_selected([])}),e.listenTo(b,i.select_node,function(a){a.id&&f.vs.get(a.id)&&(b.trigger(i.unselect_nodes),b.trigger(i.unselect_edges),f.vs.set_selected(a))}),e.listenTo(b,i.select_edge,function(a,c){b.trigger(i.unselect_nodes),b.trigger(i.unselect_edges)}),e.listenTo(b,i.remove_all,function(){e.set_auto_compute(!1),f.vs.set([]),f.es.set([]),e.set_auto_compute(!0)}),e.listenTo(b,i.remove_node,function(a){e.set_auto_compute(!1),a&&(f.vs.set_selected([]),f.vs.remove(a)),e.set_auto_compute(!0),e.trigger("engine:auto_compute",e.models.graph)}),e.listenTo(b,i.remove_edge,function(a){e.set_auto_compute(!1),a&&(f.es.set_selected([]),f.es.remove(a)),e.set_auto_compute(!0),e.trigger("engine:auto_compute",e.models.graph)}),this.listenTo(b,"request-graph-clear",function(a){b.trigger(i.unselect_nodes),b.trigger(i.unselect_edges),e.set_auto_compute(!1),f.vs.set([]),e.set_auto_compute(!0)})},create_clustering_model:function(){var a=this;a.models.clustering=new d.Clustering({ClusterModel:x.Cluster,color_saturation:71,color_value:80})},create_engines:function(){var c=this,e=c.routes,f=function(a){var e=new d.Engine(a);return c.listenTo(e,"play:loading",function(){b.trigger("play:loading",e)}),c.listenTo(e,"play:error",function(){b.trigger("play:complete",e)}),c.listenTo(e,"play:success",function(){b.trigger("play:complete",e)}),e};if(e.explore){var g=f({url:e.explore.url});g.register_input("request",c.models.query),c.listenTo(b,"engine:explore",function(a){c.models.query.reset_from_models(a),g.play()}),c.listenTo(g,"play:success",c.explore_reset),c.engines.explore=g}if(e.starred){var h=f({url:e.starred.url});h.register_input("request",c.models.query),c.listenTo(b,"engine:starred",function(a){c.models.query.reset_from_models(a),h.play()}),c.listenTo(h,"play:success",c.explore_reset),c.engines.starred=h}if(e.additive_nodes){var i=new x.AdditiveNodesQuery({graph:c.models.graph});c.engines.additive_nodes=f({url:e.additive_nodes.url}),c.engines.additive_nodes.register_input("request",i),c.listenTo(b,"engine:additive_nodes",c.additive_nodes),c.listenTo(c.engines.additive_nodes,"play:success",c.merge_graph)}if(e.expand_px){var j=new x.ExpandNodesQuery({graph:c.models.graph});c.engines.expand_prox=f({url:e.expand_px.url}),c.engines.expand_prox.register_input("request",j),c.listenTo(b,"engine:expand_prox",function(a){console.log("engine:expand_prox",a),j.set("nodes",a.nodes),j.set("weights",a.weights),c.engines.expand_prox.play()}),c.listenTo(c.engines.expand_prox,"play:success",c.expand_graph)}if(e.layout){var k=f({url:e.layout.url});k.register_input("request",new x.IndexEdgeListQuery({graph:c.models.graph})),c.on("engine:layout",function(a){if(k.blocks.length){console.log("engine:layout",a);var b=k.blocks.at(0).components;b.each(function(a){a.set("selected",!1)});var c=b.get(a);c||(c=b.at(0)),c.set("selected",!0),k.play()}});var l=(c.models.graph,function(a,c,d){v(c,d),a._additive_nodes_delayed=!1,b.trigger("engine:request_animation")});c.listenTo(k,"play:success",a.partial(l,c,c.models.graph)),c.engines.layout=k}if(e.clustering){var m=f({url:e.clustering.url});m.register_input("request",new x.IndexEdgeListQuery({graph:c.models.graph})),c.on("engine:clustering",function(a){console.log("engine:clustering",a);var b=m.blocks;if(b.length){var c=b.at(0).components;c.each(function(a){a.set("selected",!1)});var d=c.get(a);d||(d=c.at(0)),d.set("selected",!0),m.play()}}),c.listenTo(m,"play:success",c.apply_clustering),c.engines.clustering=m}for(var n in e)if(!c.engines[n]){var o=f({url:e[n].url});c.engines[n]=o}c.listenTo(b,"play:error",c.engine_play_error),c.on("engine:auto_compute",c.auto_compute)},fetch_engines:function(b){var c=this,d={complete:b,count:a.size(c.engines)},e=function(a){if(d.count-=1,console.log(" engine_fetched ",d.count),0==d.count)if(d.complete)d.complete(c);else{var b=new Event("app_engines_fetched",{bubbles:!0,cancelable:!1});document.dispatchEvent(b)}};c.engines.layout&&c.engines.layout.fetch({success:function(b,d,f,g){if(a.size(d.blocks)){var h=d.blocks.at(0),i=h.components.models,k=[],l=["# Layouts"],m=0;for(var n in i){m++;var o=""+m,p=i[n].id+"|";p=p.substring(0,p.indexOf("|"));var q=""+i[n].id,r=function(a){return function(){c.trigger("engine:layout",a)}};l.push([o,p,r(q)]),k.push({name:p,value:q,model:i[n]})}j(this.$el,l,"!"),c.setLayouts(k),e()}}}),c.engines.clustering&&c.engines.clustering.fetch({success:function(b,d,f,g){if(a.size(d.blocks)){var h=d.blocks.at(0),i=h.components.models,k=[],l=["# Community detection"],m=0;for(var n in i){m++;var o=""+m,p=i[n].id+"|";p=p.substring(0,p.indexOf("|"));var q=i[n].id,r=function(a){return function(){c.trigger("engine:clustering",a)}};l.push([o,p,r(q)]),k.push({name:p,value:q,model:i[n]})}j(this.$el,l,":"),c.setClusterings(k),e()}}});for(var f in c.engines)console.log(" FETCH ENGINES "+f),"clustering"!=f&&"layout"!=f&&c.engines[f].fetch({success:e})},auto_compute:function(){if(this.ALLOW_AUTO_COMPUTE&&!this._auto_compute_delay){var a=this.models.graph;a&&a.vs&&a.vs.length&&(this.engines.clustering&&this.engines.clustering.play(),this.engines.layout&&this.engines.layout.play())}},noop:function(){},additive_nodes:function(b,c){if(this._additive_nodes_uuids=a.union(this._additive_nodes_uuids,b),!this._additive_nodes_delay){this._additive_nodes_delayed=!0;var d=this.engines.additive_nodes;console.log("engine:additive_nodes",this._additive_nodes_uuids,c),d.input_models.request.set("uuids",this._additive_nodes_uuids),d.play(c),this._additive_nodes_uuids=[]}},explore_reset:function(a){b.trigger(i.unselect_nodes),b.trigger(i.unselect_edges);var c=this;c.response=a,console.log("explore_reset",a.results),c.set_auto_compute(!1),a.results.graph&&(c.models.graph.reset(a.results.graph),c.models.graph.set("gid",a.results.graph.properties.name),c.models.graph.vs.each(function(a){a.add_flag("form")})),c.set_auto_compute(!0),c.auto_compute()},expand_graph:function(c){if(console.log("expand_graph",c.results),!(!c|!("results"in c))){var d=this.models.graph,e=[],f=a.pairs(c.results.scores);f.sort(function(a,b){return a[1]<b[1]?1:-1});for(var g in f){var h=f[g][0],i=f[g][1];if(null==d.vs.get(h)){if(e.length>=10&&i<1)break;console.log("expand_graph adding vertex : "+h,i),e.push(h)}}e.length&&b.trigger("engine:additive_nodes",e)}},clusters_labels:function(a,b){this.models.clustering.set_labels(a.results,b)},merge_graph:function(a,b){!a|!("results"in a)|!("graph"in a.results)||(this.set_auto_compute(!1),b||(b={}),b&&b.reset?this.models.graph.reset(a.results.graph):this.models.graph.merge(a.results.graph),this.models.graph.vs.each(function(a){a.add_flag("form")}),b.callback&&b.callback(),this.set_auto_compute(!0),this.auto_compute())},apply_clustering:function(c){if(!c|!("results"in c)|!("clusters"in c.results))return void b.trigger("engine:error",{message:"No response or no results in response",response:c});this.models.clustering.reset(c.results.clusters,{members:{vs:{source:this.models.graph.vs,id_field:"vids"}}}),this.models.clustering.clusters.each(function(a){a.listenTo(b,"unselect_clusters",function(){a.remove_flag("selected")})});for(var d in this.models.clustering.clusters.models){var e=this.models.clustering.clusters.at(d),f=e.members.vs.models,g="000"+d,h=g.substring(g.length-3)+"/"+(e.misc?"0":"1");a.each(f,function(a){a.set("_sort_by_cluster",h+"/"+a.label)})}b.trigger("engine:request_animation")},set_auto_compute:function(a){this.ALLOW_AUTO_COMPUTE=a},search_loading:function(a,b){},engine_play_error:function(b,c){var d=this;if(console.log("play:error","response",b),$("#loading-indicator").hide(0),d.DEBUG){d.response=b,d.xhr=c;var e;a.isEmpty(b)?(e=$(c.responseText),$("body").css("margin","0")):e=b.meta.errors.join("<br />"),$("body").after(e)}},set_viz:function(c){var d=this,e=d.models.graph;this.listenTo(b,i.select_node,function(b){if(d.AUTO_FOCUS){var e=a.pick(c.wnidx[b.id].position,"x","y","z");c.setFocus(e)}c.request_animation()}),this.listenTo(b,i.select_edge,function(a,b){a&&e.es.set_selected(a),c.setFocus()}),this.listenTo(e,"change:gid",function(){c.collapse()}),p(),o(c,""),n(this.$el,this.models.graph,""),m(this.$el,this.models.graph,""),c.animate()},install_listeners:function(){}}),B.Iframe=B.Base.extend({initialize:function(a,b){B.Iframe.__super__.initialize.apply(this,arguments)},setClusterings:function(a){this.clusterings=a},setLayouts:function(a){this.layouts=a}}),B.Simple=B.Base.extend({initialize:function(a,b){B.Simple.__super__.initialize.apply(this,arguments)},setClusterings:function(a){var b=$("padagraph-app-menu")[0],c=$("padagraph-controls")[0];b.clusterings=a,c.clusterings=a,this.clusterings=a},setLayouts:function(a){var b=$("padagraph-app-menu")[0],c=$("padagraph-controls")[0];b.layouts=a,c.layouts=a,this.layouts=a},create_models:function(){this.create_graph_model(),this.create_clustering_model(),this.create_query_model(),this.create_user_model()},start:function(){var a=this,c=a.models.graph;a.listenTo(c,"change:gid",function(){$("padagraph-graph-button")[0].graphname=c.id});var e=$("padagraph-app-menu")[0];e.themes=Object.keys(THEMES),e.graph=c,e.app=a;var f=$("padagraph-controls")[0];f.themes=Object.keys(THEMES),f.app=a,f.gviz=k,f.graph=c,f.setupUI();var g=$("padagraph-create")[0];g.graph=c,g.nodetype_model=c.nodetype_model,g.edgetype_model=c.edgetype_model,g.vertex_model=c.vertex_model,g.edge_model=c.edge_model;var h=$("padagraph-edits")[0];h.graph=c;var i=$("padagraph-messages")[0];i.graph=c,$("padagraph-node-search")[0].graph=c,$("padagraph-notifications")[0].setGraphModel(c),$("#newNodeType").click(function(){b.trigger("edit:nodetype",!1)}),initUI(),this.setFullscreen=function(a){this.fullscreen=a,setFullscreen(a)},this.setTheme=setTheme;var j=$("padagraph-gviz")[0],k=j.gviz;a.set_viz(k),this.gviz=j,window._app=this,window.Cello=d,window.Models=x,console.warn=function(){}}}),B});